/** Oslo JavaScript Framework. */
define("@net.IframeIo",["@util","@Timer","@uri.util","@dom.util","@events.util","@events.eventBase","@events.eventTarget","@events.eventType","@json.util","@net.errorCode","@net.eventType","@string.util","@ua.util","@log","@ds.util","@uri.Uri"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";var q=0,r={};function s(){return t.FRAME_NAME_PREFIX+q++}var t=function(){g.call(this),this.name_=s(),this.iframesForDisposal_=[],r[this.name_]=this};return a.inherits(t,g),t.FRAME_NAME_PREFIX="oslo_frame",t.INNER_FRAME_SUFFIX="_inner",t.IFRAME_DISPOSE_DELAY_MS=2e3,t.form_,t.send=function(a,b,c,d,f){var g=new t;e.listen(g,k.READY,g.dispose,!1,g),b&&e.listen(g,k.COMPLETE,b),g.send(a,c,d,f)},t.getIframeByName=function(a){return window.frames[a]},t.getInstanceByName=function(a){return r[a]},t.handleIncrementalData=function(a,b){var c=l.endsWith(a.name,t.INNER_FRAME_SUFFIX)?a.parent.name:a.name,d=c.substring(0,c.lastIndexOf("_")),e=t.getInstanceByName(d);e&&c===e.iframeName_?e.handleIncrementalData_(b):n.getLogger("Oslo.net.IframeIo").info("Incremental iframe data routed for unknown iframe")},t.getForm_=function(){if(!t.form_){t.form_=d.createDom("form"),t.form_.acceptCharset="utf-8";var a=t.form_.style;a.position="absolute",a.visibility="hidden",a.top=a.left="-10px",a.width=a.height="10px",a.overflow="hidden",d.getDocument().body.appendChild(t.form_)}return t.form_},t.addFormInputs_=function(a,b){var c=d.getDomHelper(a);o.forEach(b,function(b,d){var e=c.createDom("input",{type:"hidden",name:d,value:b});a.appendChild(e)})},t.prototype.logger_=n.getLogger("Oslo.net.IframeIo"),t.prototype.form_=null,t.prototype.iframe_=null,t.prototype.iframeName_=null,t.prototype.nextIframeId_=0,t.prototype.active_=!1,t.prototype.complete_=!1,t.prototype.success_=!1,t.prototype.lastUri_=null,t.prototype.lastContent_=null,t.prototype.lastErrorCode_=j.NO_ERROR,t.prototype.timeoutInterval_=0,t.prototype.timeoutId_=null,t.prototype.firefoxSilentErrorTimeout_=null,t.prototype.iframeDisposalTimer_=null,t.prototype.errorHandled_=!1,t.prototype.ignoreResponse_=!1,t.prototype.send=function(a,b,c,d){if(this.active_)throw Error("[Oslo.net.IframeIo] Unable to send, already active.");var e=new p(a);this.lastUri_=e;var f=b?b.toUpperCase():"GET";c&&e.makeUnique(),n.info(this.logger_,"Sending iframe request: "+e+" ["+f+"]"),this.form_=t.getForm_(),"GET"==f&&t.addFormInputs_(this.form_,e.getQueryData()),d&&t.addFormInputs_(this.form_,d),this.form_.action=e.toString(),this.form_.method=f,this.sendFormInternal_()},t.prototype.sendFromForm=function(a,b,c){if(this.active_)throw Error("[Oslo.net.IframeIo] Unable to send, already active.");var d=new p(b||a.action);c&&d.makeUnique(),n.info(this.logger_,"Sending iframe request from form: "+d),this.lastUri_=d,this.form_=a,this.form_.action=d.toString(),this.sendFormInternal_()},t.prototype.abort=function(a){this.active_&&(n.info(this.logger_,"Request aborted"),e.removeAll(this.getRequestIframe()),this.complete_=!1,this.active_=!1,this.success_=!1,this.lastErrorCode_=a||j.ABORT,this.dispatchEvent(h.ABORT),this.makeReady_())},t.prototype.disposeInternal=function(){n.fine(this.logger_,"Disposing iframeIo instance"),this.active_&&(n.fine(this.logger_,"Aborting active request"),this.abort()),t.superClass_.disposeInternal.call(this),this.iframe_&&this.scheduleIframeDisposal_(),this.disposeForm_(),delete this.errorChecker_,this.form_=null,this.lastCustomError_=this.lastContent_=this.lastContentHtml_=null,this.lastUri_=null,this.lastErrorCode_=j.NO_ERROR,delete r[this.name_]},t});