/** Oslo JavaScript Framework. */
define(["./util","../disposable/disposable","../array/array"],function(a,b,c){"use strict";var d=function(){b.call(this),this.subscriptions_=[],this.topics_={}};return a.inherits(d,b),d.prototype.subscriptions_=null,d.prototype.key_=1,d.prototype.topics_=null,d.prototype.pendingKeys_=null,d.prototype.publishDepth_=0,d.prototype.subscribe=function(a,b,c){var d=this.topics_[a];d||(d=this.topics_[a]=[]);var e=this.key_;return this.subscriptions_[e]=a,this.subscriptions_[e+1]=b,this.subscriptions_[e+2]=c,this.key_=e+3,d.push(e),e},d.prototype.subscribeOnce=function(a,b,c){var d=this.subscribe(a,function(){b.apply(c,arguments),this.unsubscribeByKey(d)},this);return d},d.prototype.unsubscribe=function(a,b,d){var e=this.topics_[a];if(e){var f=this.subscriptions_,g=c.find(e,function(a){return f[a+1]===b&&f[a+2]===d});if(g)return this.unsubscribeByKey(g)}return!1},d.prototype.unsubscribeByKey=function(a){if(0!==this.publishDepth_)return this.pendingKeys_||(this.pendingKeys_=[]),this.pendingKeys_.push(a),!1;var b=this.subscriptions_[a];if(b){var d=this.topics_[b];d&&c.remove(d,a),delete this.subscriptions_[a],delete this.subscriptions_[a+1],delete this.subscriptions_[a+2]}return!!b},d.prototype.publish=function(a){var b=this.topics_[a];if(b){this.publishDepth_++;for(var d=c.slice(arguments,1),e=0,f=b.length;f>e;e++){var g=b[e];this.subscriptions_[g+1].apply(this.subscriptions_[g+2],d)}if(this.publishDepth_--,this.pendingKeys_&&0===this.publishDepth_)for(var h;h=this.pendingKeys_.pop();)this.unsubscribeByKey(h);return 0!==e}return!1},d.prototype.clear=function(a){if(a){var b=this.topics_[a];b&&(c.forEach(b,this.unsubscribeByKey,this),delete this.topics_[a])}else this.subscriptions_.length=0,this.topics_={}},d.prototype.getCount=function(a){if(a){var b=this.topics_[a];return b?b.length:0}var c=0;for(var d in this.topics_)c+=this.getCount(d);return c},d.prototype.disposeInternal=function(){d.superClass_.disposeInternal.call(this),delete this.subscriptions_,delete this.topics_,delete this.pendingKeys_},d});