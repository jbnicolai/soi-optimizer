/** Oslo JavaScript Framework. */
define(["../util/util","../array/array","./listener","../object/object"],function(a,b,c,d){"use strict";function e(a){this.src=a,this.listeners={},this.typeCount_=0}return a.mixin(e.prototype,{getTypeCount:function(){return this.typeCount_},getListenerCount:function(){var a=0;for(var b in this.listeners)a+=this.listeners[b].length;return a},add:function(a,b,d,f,g){var h=this.listeners[a];h||(h=this.listeners[a]=[],this.typeCount_++);var i,j=e.findListenerIndex_(h,b,f,g);return j>-1?(i=h[j],d||(i.callOnce=!1)):(i=new c(b,null,this.src,a,!!f,g),i.callOnce=d,h.push(i)),i},remove:function(a,c,d,f){if(!(a in this.listeners))return!1;var g=this.listeners[a],h=e.findListenerIndex_(g,c,d,f);if(h>-1){var i=g[h];return i.markAsRemoved(),b.removeAt(g,h),0===g.length&&(delete this.listeners[a],this.typeCount_--),!0}return!1},getListeners:function(a,b){var c=this.listeners[a],d=[];if(c)for(var e=0;e<c.length;++e){var f=c[e];f.capture===b&&d.push(f)}return d},getListener:function(a,b,c,d){var f=this.listeners[a],g=-1;return f&&(g=e.findListenerIndex_(f,b,c,d)),g>-1?f[g]:null},hasListener:function(b,c){var e=!a.isNull(b),f=!a.isNull(c);return d.some(this.listeners,function(a){for(var d=0;d<a.length;++d)if(!(e&&a[d].type!==b||f&&a[d].capture!==c))return!0;return!1})},removeByKey:function(a){var c=a.type;if(!(c in this.listeners))return!1;var d=b.remove(this.listeners[c],a);return d&&(a.markAsRemoved(),0===this.listeners[c].length&&(delete this.listeners[c],this.typeCount_--)),d},removeAll:function(a){var b=0;for(var c in this.listeners)if(!a||c===a){for(var d=this.listeners[c],e=0;e<d.length;e++)++b,d[e].removed=!0;delete this.listeners[c],this.typeCount_--}return b}}),e.findListenerIndex_=function(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.removed&&f.listener===b&&f.capture===c&&f.context===d)return e}return-1},e});