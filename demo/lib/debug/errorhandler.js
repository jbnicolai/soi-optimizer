/** Oslo JavaScript Framework. */
define(["../util/util","../disposable/disposable","../asserts/asserts","../debug/util","../debug/error","../debug/entrypointregistry","../debug/tracer"],function(a,b,c,d,e,f,g){"use strict";var h=function(a){b.call(this),this.errorHandlerFn_=a,this.wrapErrors_=!0,this.prefixErrorMessages_=!1};return a.inherits(h,b),h.prototype.addTracersToProtectedFunctions_=!1,h.prototype.setAddTracersToProtectedFunctions=function(a){this.addTracersToProtectedFunctions_=a},h.prototype.wrap=function(a){return this.protectEntryPoint(c.assertFunction(a))},h.prototype.unwrap=function(a){return c.assertFunction(a),a[this.getFunctionIndex_(!1)]||a},h.prototype.getStackTraceHolder_=function(a){var b=[];return b.push("##PE_STACK_START##"),b.push(a.replace(/(\r\n|\r|\n)/g,"##STACK_BR##")),b.push("##PE_STACK_END##"),b.join("")},h.prototype.getFunctionIndex_=function(b){return(b?"__wrapper_":"__protected_")+a.getUid(this)+"__"},h.prototype.protectEntryPoint=function(a){var b=this.getFunctionIndex_(!0);if(!a[b]){var c=a[b]=this.getProtectedFunction(a);c[this.getFunctionIndex_(!1)]=a}return a[b]},h.prototype.getProtectedFunction=function(b){var c,e,f=this,i=this.addTracersToProtectedFunctions_;i&&(e=d.getStacktraceSimple(15));var j=function(){if(f.isDisposed())return b.apply(this,arguments);i&&(c=g.startTracer("protectedEntryPoint: "+f.getStackTraceHolder_(e)));try{return b.apply(this,arguments)}catch(d){if(f.errorHandlerFn_(d),!f.wrapErrors_)throw f.prefixErrorMessages_&&("object"==typeof d?d.message=h.ProtectedFunctionError.MESSAGE_PREFIX+d.message:d=h.ProtectedFunctionError.MESSAGE_PREFIX+d),a.DEBUG&&d&&d.stack&&Error.captureStackTrace&&a.global.console&&a.global.console.error(d.message,d.stack),d;throw new h.ProtectedFunctionError(d)}finally{i&&g.stopTracer(c)}};return j[this.getFunctionIndex_(!1)]=b,j},h.prototype.protectWindowSetTimeout=function(){this.protectWindowFunctionsHelper_("setTimeout")},h.prototype.protectWindowSetInterval=function(){this.protectWindowFunctionsHelper_("setInterval")},h.prototype.protectWindowRequestAnimationFrame=function(){for(var a=window,b=["requestAnimationFrame","mozRequestAnimationFrame","webkitAnimationFrame","msRequestAnimationFrame"],c=0;c<b.length;c++){var d=b[c];b[c]in a&&(a[d]=this.protectEntryPoint(a[d]))}},h.prototype.protectWindowFunctionsHelper_=function(b){var c=window,d=c[b],e=this;c[b]=function(b,c){return a.isString(b)&&(b=a.partial(a.globalEval,b)),b=e.protectEntryPoint(b),d.call?d.call(this,b,c):d(b,c)},c[b][this.getFunctionIndex_(!1)]=d},h.prototype.setWrapErrors=function(a){this.wrapErrors_=a},h.prototype.setPrefixErrorMessages=function(a){this.prefixErrorMessages_=a},h.prototype.disposeInternal=function(){var a=window;a.setTimeout=this.unwrap(a.setTimeout),a.setInterval=this.unwrap(a.setInterval),h.superClass_.disposeInternal.call(this)},h.ProtectedFunctionError=function(b){var c=h.ProtectedFunctionError.MESSAGE_PREFIX+(b&&b.message?String(b.message):String(b));e.call(this,c),this.cause=b;var d=b&&b.stack;d&&a.isString(d)&&(this.stack=d)},a.inherits(h.ProtectedFunctionError,e),h.ProtectedFunctionError.MESSAGE_PREFIX="Error in protected function: ",h});