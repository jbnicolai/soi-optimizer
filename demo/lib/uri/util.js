/** Oslo JavaScript Framework. */
define(["../util/util","../string/util","../ua/util"],function(a,b,c){"use strict";var d={AMPERSAND:38,EQUAL:61,HASH:35,QUESTION:63},e=function(a,b,c,d,e,f,g){var h="";return a&&(h+=a+":"),c&&(h+="//",b&&(h+=b+"@"),h+=c,d&&(h+=":"+d)),e&&(h+=e),f&&(h+="?"+f),g&&(h+="#"+g),h},f=new RegExp("^(?:([^:/?#.]+):)?(?://(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$"),g={SCHEME:1,USER_INFO:2,DOMAIN:3,PORT:4,PATH:5,QUERY_DATA:6,FRAGMENT:7},h=function(a){return j(),a.match(f)},i=c.isWEBKIT,j=function(){if(i){i=!1;var b=a.global.location;if(b){var c=b.href;if(c){var d=r(c);if(d&&d!==b.hostname)throw i=!0,Error()}}}},k=function(a){return a&&decodeURIComponent(a)},l=function(a,b){return h(b)[a]||null},m=function(a){return l(g.SCHEME,a)},n=function(a){var b=m(a);if(!b&&window.location){var c=window.location.protocol;b=c.substr(0,c.length-1)}return b?b.toLowerCase():""},o=function(a){return l(g.USER_INFO,a)},p=function(a){return k(o(a))},q=function(a){return l(g.DOMAIN,a)},r=function(a){return k(q(a))},s=function(a){return Number(l(g.PORT,a))||null},t=function(a){return l(g.PATH,a)},u=function(a){return k(t(a))},v=function(a){return l(g.QUERY_DATA,a)},w=function(a){var b=a.indexOf("#");return 0>b?null:a.substr(b+1)},x=function(a,b){return B(a)+(b?"#"+b:"")},y=function(a){return k(w(a))},z=function(a){var b=h(a);return e(b[g.SCHEME],b[g.USER_INFO],b[g.DOMAIN],b[g.PORT])},A=function(a){var b=h(a);return e(null,null,null,null,b[g.PATH],b[g.QUERY_DATA],b[g.FRAGMENT])},B=function(a){var b=a.indexOf("#");return 0>b?a:a.substr(0,b)},C=function(a,b){var c=h(a),d=h(b);return c[g.DOMAIN]===d[g.DOMAIN]&&c[g.SCHEME]===d[g.SCHEME]&&c[g.PORT]===d[g.PORT]},D=function(b){if(a.DEBUG&&(b.indexOf("#")>=0||b.indexOf("?")>=0))throw Error("uri.utils: Fragment or query identifiers are not supported: ["+b+"]")},E=function(a){if(a[1]){var b=a[0],c=b.indexOf("#");c>=0&&(a.push(b.substr(c)),a[0]=b=b.substr(0,c));var d=b.indexOf("?");0>d?a[1]="?":d===b.length-1&&(a[1]=void 0)}return a.join("")},F=function(c,d,e){if(a.isArray(d))for(var f=0;f<d.length;f++)F(c,String(d[f]),e);else a.isNull(d)||e.push("&",c,""===d?"":"=",b.urlEncode(d))},G=function(a,b,c){for(var d=c||0;d<b.length;d+=2)F(b[d],b[d+1],a);return a},H=function(a,b){var c=G([],a,b);return c[0]="",c.join("")},I=function(a,b){for(var c in b)F(c,b[c],a);return a},J=function(a){var b=I([],a);return b[0]="",b.join("")},K=function(a){return E(2===arguments.length?G([a],arguments[1],0):G([a],arguments,1))},L=function(a,b){return E(I([a],b))},M=function(c,d,e){var f=[c,"&",d];return a.isDef(e)&&!a.isNull(e)&&f.push("=",b.urlEncode(e)),E(f)},N=function(a,b,c,e){for(var f=b,g=c.length;(f=a.indexOf(c,f))>=0&&e>f;){var h=a.charCodeAt(f-1);if(h===d.AMPERSAND||h===d.QUESTION){var i=a.charCodeAt(f+g);if(!i||i===d.EQUAL||i===d.AMPERSAND||i===d.HASH)return f}f+=g+1}return-1},O=/#|$/,P=function(a,b){return N(a,0,b,a.search(O))>=0},Q=function(a,c){var d=a.search(O),e=N(a,0,c,d);if(0>e)return null;var f=a.indexOf("&",e);return(0>f||f>d)&&(f=d),e+=c.length+1,b.urlDecode(a.substr(e,f-e))},R=function(a,c){for(var d,e=a.search(O),f=0,g=[];(d=N(a,f,c,e))>=0;)f=a.indexOf("&",d),(0>f||f>e)&&(f=e),d+=c.length+1,g.push(b.urlDecode(a.substr(d,f-d)));return g},S=/[?&]($|#)/,T=function(a,b){for(var c,d=a.search(O),e=0,f=[];(c=N(a,e,b,d))>=0;)f.push(a.substring(e,c)),e=Math.min(a.indexOf("&",c)+1||d,d);return f.push(a.substr(e)),f.join("").replace(S,"$1")},U=function(a,b,c){return M(T(a,b),b,c)},V=function(a,c){return D(a),b.endsWith(a,"/")&&(a=a.substr(0,a.length-1)),b.startsWith(c,"/")&&(c=c.substr(1)),b.buildString(a,"/",c)},W={RANDOM:"zx"},X=function(a){return U(a,W.RANDOM,b.getRandomString())};return{buildFromEncodedParts:e,ComponentIndex:g,split:h,getScheme:m,getEffectiveScheme:n,getUserInfoEncoded:o,getUserInfo:p,getDomainEncoded:q,getDomain:r,getPort:s,getPathEncoded:t,getPath:u,getQueryData:v,getFragmentEncoded:w,setFragmentEncoded:x,getFragment:y,getHost:z,getPathAndAfter:A,removeFragment:B,haveSameDomain:C,buildQueryData:H,buildQueryDataFromMap:J,appendParams:K,appendParamsFromMap:L,appendParam:M,hasParam:P,getParamValue:Q,getParamValues:R,removeParam:T,setParam:U,appendPath:V,StandardQueryParam:W,makeUnique:X}});